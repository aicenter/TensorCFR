#!/usr/bin/env python3
import logging
import os

from src.algorithms.tensorcfr_best_response.ExploitabilityByTensorCFR import ExploitabilityByTensorCFR
from src.commons.constants import PROJECT_ROOT
from src.domains.available_domains import get_domain_by_name
from src.utils.gambit_flattened_domains.loader import GambitLoaderCached

if __name__ == '__main__':
	# domain_ = get_domain_by_name("II-GS3_scalar_util_gambit_flattened")
	path_to_domain_efg = os.path.join(
		PROJECT_ROOT,
		'doc',
		'goofspiel',
		'II-GS3_scalar_util.efg'
	)

	domain_in_numpy = GambitLoaderCached(path_to_domain_efg)

	trunk_strategies_gs3_td4 = [
		[  # infoset strategies at level 0
			[1.]
		],

		[  # infoset strategies at level 1
			[0.01, 0.9, 0.09]
		],

		[  # infoset strategies at level 2
			[0.69, 0.04, 0.27]
		],

		[  # infoset strategies at level 3
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.]
		],

		[  # infoset strategies at level 4
			[.1, .9],
			[.2, .8],
			[.3, .7],
			[.4, .6],
			[.5, .5],
			[.6, .4],
			[.7, .3]
		],

		[  # infoset strategies at level 5
			[.9, .1],
			[.8, .2],
			[.7, .3],
			[.6, .4],
			[.5, .5],
			[.4, .6],
			[.3, .7]
		],

		[  # infoset strategies at level 6
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.],
			[1.]
		]
	]

	exploitability_tensorcfr = ExploitabilityByTensorCFR(
		domain_in_numpy,
		trunk_depth=7,
		trunk_strategies=trunk_strategies_gs3_td4,
		total_steps=10,
		delay=1,
		log_lvl=logging.INFO
	)

	exploitability_tensorcfr.evaluate(trunk_strategies=trunk_strategies_gs3_td4, trunk_depth=7)

	print("final BR value (player 1): {}".format(exploitability_tensorcfr.final_brvalue_1))
	print("final BR value (player 2): {}".format(exploitability_tensorcfr.final_brvalue_2))
	print("final exploitability: {}".format(exploitability_tensorcfr.final_exploitability))
